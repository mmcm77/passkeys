!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.PayAuth=t():e.PayAuth=t()}(this,(()=>(()=>{"use strict";var e,t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},s={};t.d(s,{default:()=>r}),function(e){e.INIT="init",e.AUTH_INIT="auth_init",e.AUTH_REQUEST="auth_request",e.AUTH_RESPONSE="auth_response",e.AUTH_SUCCESS="auth_success",e.AUTH_CANCEL="auth_cancel",e.AUTH_READY="auth_ready",e.ERROR="error",e.CLOSE="close"}(e||(e={}));class i{constructor(t,s=!1){this.iframeWindow=null,this.messageListeners=new Map,this.iframe=null,this.trustedOrigins=[],this.useTokenAuth=!1,this.handleMessage=t=>{if(!this.useTokenAuth){this.trustedOrigins.includes(t.origin)||"*"===this.targetOrigin||console.warn(`Message origin ${t.origin} is not in trusted origins list. Expected one of: ${this.trustedOrigins.join(", ")}`)}const s=t.data;if(!s||"object"!=typeof s)return void console.warn("Received invalid message format");if(!s.type||!Object.values(e).includes(s.type))return void console.warn(`Received unknown message type: ${s.type}`);if(s.sessionId&&s.sessionId!==this.sessionId)return void console.warn("Session ID mismatch, ignoring message");const i=this.messageListeners.get(s.type);i&&i.forEach((e=>{try{e(s.payload)}catch(e){console.error("Error in message listener:",e)}}))};try{const e=new URL(t);this.targetOrigin=e.origin,this.trustedOrigins=[this.targetOrigin],this.useTokenAuth=s}catch(e){console.error("Invalid service URL:",e),this.targetOrigin="*"}if(this.sessionId=this.generateSessionId(),window.addEventListener("message",this.handleMessage),"undefined"!=typeof window&&window.location){const e=window.location.origin;this.trustedOrigins.includes(e)||this.trustedOrigins.push(e)}}generateSessionId(){return"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}addTrustedOrigin(e){this.trustedOrigins.includes(e)||this.trustedOrigins.push(e)}getSessionId(){return this.sessionId}setIframeWindow(e){this.iframe=e,this.iframeWindow=(null==e?void 0:e.contentWindow)||null}setUseTokenAuth(e){this.useTokenAuth=e}sendMessage(e,t){if(!this.iframeWindow)return void console.error("Cannot send message: iframe window not set");const s={type:e,payload:t,sessionId:this.sessionId};this.iframeWindow.postMessage(s,this.targetOrigin)}on(e,t){var s;return this.messageListeners.has(e)||this.messageListeners.set(e,[]),null===(s=this.messageListeners.get(e))||void 0===s||s.push(t),()=>this.off(e,t)}off(e,t){const s=this.messageListeners.get(e);if(!s)return;const i=s.indexOf(t);-1!==i&&s.splice(i,1)}destroy(){window.removeEventListener("message",this.handleMessage),this.messageListeners.clear()}}class n{constructor(e){this.iframe=null,this.overlay=null,this.options=e;const t=e.serviceUrl||"https://passkeys-one.vercel.app";e.messageHandler?this.messageHandler=e.messageHandler:(this.messageHandler=new i(t),"undefined"!=typeof window&&window.location&&this.messageHandler.addTrustedOrigin(window.location.origin));const s="undefined"!=typeof window&&window.location?`&origin=${encodeURIComponent(window.location.origin)}`:"";this.iframeSrc=`${t}/auth-embed?merchantId=${encodeURIComponent(e.merchantId)}&sessionId=${this.messageHandler.getSessionId()}${s}`,e.apiToken&&(this.iframeSrc+=`&apiToken=${encodeURIComponent(e.apiToken)}`),e.theme&&(this.iframeSrc+=`&theme=${e.theme}`),this.setupMessageListeners()}setupMessageListeners(){this.messageHandler.on(e.AUTH_READY,(()=>{console.log("Authentication iframe is ready"),this.messageHandler.sendMessage(e.AUTH_INIT,{merchantId:this.options.merchantId,theme:this.options.theme})})),this.messageHandler.on(e.AUTH_RESPONSE,(e=>{var t,s;console.log("Authentication successful for:",e.email),null===(s=null===(t=this.options.callbacks)||void 0===t?void 0:t.onSuccess)||void 0===s||s.call(t,e),this.closeIframe()})),this.messageHandler.on(e.AUTH_SUCCESS,(e=>{var t,s;console.log("Authentication successful for:",e.email),null===(s=null===(t=this.options.callbacks)||void 0===t?void 0:t.onSuccess)||void 0===s||s.call(t,e),this.closeIframe()})),this.messageHandler.on(e.ERROR,(e=>{var t,s;null===(s=null===(t=this.options.callbacks)||void 0===t?void 0:t.onError)||void 0===s||s.call(t,e)})),this.messageHandler.on(e.AUTH_CANCEL,(()=>{var e,t;null===(t=null===(e=this.options.callbacks)||void 0===e?void 0:e.onCancel)||void 0===t||t.call(e),this.closeIframe()})),this.messageHandler.on(e.CLOSE,(()=>{this.closeIframe()}))}openIframe(){var e,t;this.overlay||(this.createOverlay(),this.createIframe(),setTimeout((()=>{this.overlay&&(this.overlay.style.opacity="1"),this.iframe&&(this.iframe.style.transform="translate(-50%, -50%) translateY(0)")}),10),null===(t=null===(e=this.options.callbacks)||void 0===e?void 0:e.onOpen)||void 0===t||t.call(e))}createOverlay(){this.overlay=document.createElement("div"),this.overlay.style.position="fixed",this.overlay.style.top="0",this.overlay.style.left="0",this.overlay.style.width="100%",this.overlay.style.height="100%",this.overlay.style.backgroundColor="rgba(0, 0, 0, 0.5)",this.overlay.style.zIndex="999999",this.overlay.style.opacity="0",this.overlay.style.transition="opacity 0.3s ease",this.overlay.style.display="flex",this.overlay.style.alignItems="center",this.overlay.style.justifyContent="center",this.overlay.addEventListener("click",(e=>{var t,s;e.target===this.overlay&&(null===(s=null===(t=this.options.callbacks)||void 0===t?void 0:t.onCancel)||void 0===s||s.call(t),this.closeIframe())})),document.body.appendChild(this.overlay)}createIframe(){var e,t,s,i,n,o,r,l;this.iframe=document.createElement("iframe"),this.iframe.src=this.iframeSrc,this.iframe.style.position="fixed",this.iframe.style.top="50%",this.iframe.style.left="50%",this.iframe.style.transform="translate(-50%, -50%) translateY(20px)",this.iframe.style.width=(null===(t=null===(e=this.options.styles)||void 0===e?void 0:e.iframe)||void 0===t?void 0:t.width)||"400px",this.iframe.style.height=(null===(i=null===(s=this.options.styles)||void 0===s?void 0:s.iframe)||void 0===i?void 0:i.height)||"500px",this.iframe.style.maxWidth="90%",this.iframe.style.maxHeight="90%",this.iframe.style.border="1px solid rgba(255, 255, 255, 0.2)",this.iframe.style.borderRadius=(null===(o=null===(n=this.options.styles)||void 0===n?void 0:n.iframe)||void 0===o?void 0:o.borderRadius)||"12px",this.iframe.style.boxShadow=(null===(l=null===(r=this.options.styles)||void 0===r?void 0:r.iframe)||void 0===l?void 0:l.boxShadow)||"0 10px 25px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1)",this.iframe.style.zIndex="1000000",this.iframe.style.transition="transform 0.3s ease",this.iframe.style.backgroundColor="#0070f3",this.iframe.style.color="#ffffff",this.iframe.setAttribute("allow","publickey-credentials-get *; publickey-credentials-create *");const a=document.createElement("button");a.innerHTML="Ã—",a.style.position="absolute",a.style.top="10px",a.style.right="10px",a.style.width="30px",a.style.height="30px",a.style.borderRadius="50%",a.style.backgroundColor="rgba(0, 0, 0, 0.1)",a.style.color="rgba(0, 0, 0, 0.6)",a.style.border="none",a.style.fontSize="18px",a.style.cursor="pointer",a.style.display="flex",a.style.alignItems="center",a.style.justifyContent="center",a.style.outline="none",a.style.transition="background-color 0.2s ease",a.addEventListener("mouseover",(()=>{a.style.backgroundColor="rgba(0, 0, 0, 0.2)"})),a.addEventListener("mouseout",(()=>{a.style.backgroundColor="rgba(0, 0, 0, 0.1)"})),a.addEventListener("click",(()=>{var e,t;null===(t=null===(e=this.options.callbacks)||void 0===e?void 0:e.onCancel)||void 0===t||t.call(e),this.closeIframe()}));const d=document.createElement("div");d.style.position="relative",d.style.zIndex="1000001",d.appendChild(this.iframe),d.appendChild(a),this.overlay&&this.overlay.appendChild(d),this.messageHandler.setIframeWindow(this.iframe)}closeIframe(){this.overlay&&(this.overlay.style.opacity="0"),this.iframe&&(this.iframe.style.transform="translate(-50%, -50%) translateY(20px)"),setTimeout((()=>{this.removeElements()}),300)}removeElements(){var e,t;this.overlay&&(document.body.removeChild(this.overlay),this.overlay=null,this.iframe=null,this.messageHandler.setIframeWindow(null),null===(t=null===(e=this.options.callbacks)||void 0===e?void 0:e.onClose)||void 0===t||t.call(e))}isOpen(){return null!==this.overlay}destroy(){this.removeElements(),this.messageHandler.destroy()}}function o(e){if(!e.merchantId)throw new Error("Passkey SDK requires a merchantId");const t=e.serviceUrl||"https://passkeys-one.vercel.app",s=Object.assign({theme:"light",buttonText:"Authenticate with Passkey",buttonStyle:"default",serviceUrl:t},e),o=!!s.apiToken,r=new i(t,o);"undefined"!=typeof window&&window.location&&r.addTrustedOrigin(window.location.origin);const l=new n({merchantId:s.merchantId,serviceUrl:t,messageHandler:r,theme:s.theme||"light",styles:s.styles,apiToken:s.apiToken});let a=null,d=null,c=!1;const h=s.callbacks||{};s.callbacks=Object.assign(Object.assign({},h),{onSuccess:e=>{c=!0,h.onSuccess&&h.onSuccess(e)},onCancel:()=>{h.onCancel&&h.onCancel()},onError:e=>{h.onError&&h.onError(e)}});const u=e=>{if(!e&&!s.container)throw new Error("No mount element or container option provided");const t=e||s.container;let i=null;"string"==typeof t?i=document.querySelector(t):t instanceof HTMLElement&&(i=t),i?(d=i,a=document.createElement("button"),a.innerText=s.buttonText||"Sign in with Passkey",y(a,s),a.addEventListener("click",f),d.appendChild(a)):console.warn(`Container element not found: ${t}`)},y=(e,t)=>{var s;e.style.display="inline-flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',e.style.fontSize="14px",e.style.fontWeight="500",e.style.padding="0 16px",e.style.cursor="pointer",e.style.border="none",e.style.outline="none",e.style.transition="all 0.2s ease",e.style.textDecoration="none",e.style.lineHeight="1";let i="#3b82f6",n="#ffffff",o="8px",r="auto",l="40px";(null===(s=t.styles)||void 0===s?void 0:s.button)&&(i=t.styles.button.backgroundColor||i,n=t.styles.button.textColor||n,o=t.styles.button.borderRadius||o,r=t.styles.button.width||r,l=t.styles.button.height||l),"minimal"===t.buttonStyle&&(i="transparent",n="#000000",o="4px"),"dark"===t.theme&&("minimal"===t.buttonStyle?n="#ffffff":"default"===t.buttonStyle&&(i="#1e40af")),e.style.backgroundColor=i,e.style.color=n,e.style.borderRadius=o,e.style.width=r,e.style.height=l},m=()=>{a&&d&&(a.removeEventListener("click",f),d.removeChild(a),a=null)},f=()=>new Promise(((e,t)=>{var i,n,o;const r=null===(i=s.callbacks)||void 0===i?void 0:i.onSuccess,a=null===(n=s.callbacks)||void 0===n?void 0:n.onError,d=null===(o=s.callbacks)||void 0===o?void 0:o.onCancel;s.callbacks=Object.assign(Object.assign({},s.callbacks),{onSuccess:t=>{c=!0,r&&r(t),e(t),h()},onError:e=>{a&&a(e),t(e),h()},onCancel:()=>{const e=new Error("Authentication cancelled by user");d&&d(),t(e),h()}});const h=()=>{var e,t;s.callbacks={onSuccess:r,onError:a,onCancel:d,onOpen:null===(e=s.callbacks)||void 0===e?void 0:e.onOpen,onClose:null===(t=s.callbacks)||void 0===t?void 0:t.onClose}};l.openIframe()}));return s.container&&u(s.container),{mount:u,unmount:m,authenticate:f,isAuthenticated:()=>c,destroy:()=>{m(),l.destroy()}}}"undefined"!=typeof window&&(window.PayAuth={init:o});const r={init:o};return s=s.default})()));